
<!DOCTYPE html>
<html lang="zh-Hans">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="chenzhesheng的博客">
    <title>Android触摸事件传递机制 - chenzhesheng的博客</title>
    <meta name="author" content="陈哲生">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"陈哲生","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"articleBody":"** Android触摸事件传递机制：** &lt;Excerpt in index | 首页摘要&gt;本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。\n\n&lt;The rest of contents | 余下全文&gt;    前言：在Android开发中，经常会遇到触摸事件冲突，比如ViewPager的轮播图跟Fragment的划动事件冲突，或者轮播图跟下拉事件冲突，自定义view的事件处理等，本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。\n一.触摸事件的类型触摸事件对应的是 MotionEvent 类，事件类型主要有三种：\n\nACTION_DOWN：用户按下操作，表示一次触摸事件的开始。 \nACTION_MOVE：在按下的情况下，进行移动。轻微的移动都会传递到该事件。\nACTION_UP：用户手指离开屏幕，表示一次触摸事件的\n\n注 ：如果用户仅仅的是点击而已，则只会执行到 ACTION_DOWN 和 ACTION_UP 两个事件，不会执行到 ACTION_MOVE 事件。所以 ACTION_DOWN 和 ACTION_UP 是事件是必须的。\n二.触摸事件的传递阶段1.分发（Dispatch）在Android系统中所有的触摸事件都是由 dispatchTouchEvent  方法进行分发的。该方法中判断事件是被消费（return true），还是继续分发给子视图处理（return super.dispatchTouchEvent），如果当前视图是ViewGroup或者其子类，则会调用onInterceptTouchEvent 判断是否截拦。\n1234@Overridepublic boolean dispatchTouchEvent(MotionEvent event) &#123;    return super.dispatchTouchEvent(event);&#125;\n\n2.截拦（Intercept）事件的截拦 InterceptTouchEvent  只存在于ViewGroup及其子类，activity和View是不存在该方法。该方法判断事件是被截拦 （return true）并交给自身的 OnToucEvent 方法进行消费，还是继续传递给子视图（return super.InterceptTouchEvent 或者 return false）。\n1234@Overridepublic boolean onInterceptTouchEvent(MotionEvent ev) &#123;    return super.onInterceptTouchEvent(ev);&#125;\n\n3.消费（Consume）事件的消费通过 OnTouchEvent 方法判断，是被消费（return true）,还是不处理（return false）并将事件传递给父视图的 OnTouchEvent 方法进行处理。\n1234@Overridepublic boolean onTouchEvent(MotionEvent event) &#123;    return super.onTouchEvent(event);&#125;\n\n所有拥有事件传递能力的类：Activity： 拥有dispatchTouchEvent 、OnTouchEventViewGroup： 拥有dispatchTouchEvent 、OnInterceptTouchEvent 、OnTouchEventView：拥有dispatchTouchEvent 、OnTouchEvent\n三、View的事件传递机制3.1 dome虽然说ViewGroup是View的子类，但是这是说的View指的是除ViewGroup之外的View控件子类，首先定义一个MyTextView继承TextView，打印每次事件的触发以变了解事件传递的流程。\nMyTextView 类\n123456789101112131415161718192021222324252627282930313233343536373839404142434445public class MyTextView extends TextView &#123;    private String tag = \"MyTextView\";    public MyTextView(Context context) &#123;        super(context);    &#125;    public MyTextView(Context context, AttributeSet attrs) &#123;        super(context, attrs);    &#125;    @Override    public boolean dispatchTouchEvent(MotionEvent event) &#123;        switch (event.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"dispatchTouchEvent ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"dispatchTouchEvent ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"dispatchTouchEvent ACTION_DOWN\");                break;        &#125;        return super.dispatchTouchEvent(event);    &#125;    @Override    public boolean onTouchEvent(MotionEvent event) &#123;        switch (event.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"onTouchEvent ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"onTouchEvent ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"onTouchEvent ACTION_DOWN\");                break;        &#125;        return super.onTouchEvent(event);    &#125;&#125;\n\n\n定义一个MainActivity来展现这个MyTextView，同时设置点击（onClick）和触摸（onTouch）监听。MainActivity 类\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778public class MainActivity extends AppCompatActivity implements View.OnClickListener,View.OnTouchListener&#123;    private MyTextView mMyTextView;    private String tag = \"MainActiviy\";    @Override    protected void onCreate(Bundle savedInstanceState) &#123;        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        mMyTextView = findViewById(R.id.text_view);        //  点击监听        mMyTextView.setOnClickListener(this);        //  触碰监听        mMyTextView.setOnTouchListener(this);    &#125;    // MyTextView 点击事件    @Override    public void onClick(View view) &#123;        switch (view.getId())&#123;            case R.id.text_view:                Log.i(tag, \"MyTextView onClick\");                break;        &#125;    &#125;    // MyTextView 触碰事件    @Override    public boolean onTouch(View view, MotionEvent motionEvent) &#123;        switch (motionEvent.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"MyTextView onTouch ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"MyTextView onTouch ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"MyTextView onTouch ACTION_DOWN\");                break;        &#125;        return false;    &#125;    // Activity　的事件分发    @Override    public boolean dispatchTouchEvent(MotionEvent ev) &#123;        switch (ev.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"dispatchTouchEvent ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"dispatchTouchEvent ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"dispatchTouchEvent ACTION_DOWN\");                break;        &#125;        return super.dispatchTouchEvent(ev);    &#125;    // Activity 的事件消费    @Override    public boolean onTouchEvent(MotionEvent event) &#123;        switch (event.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"onTouchEvent ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"onTouchEvent ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"onTouchEvent ACTION_DOWN\");                break;        &#125;        return super.onTouchEvent(event);    &#125;&#125;\n\n3.2 打印日志运行后，点击Text View反馈的打印日志\n12345678903-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_DOWN03-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_DOWN03-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_DOWN03-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_DOWN03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_UP03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_UP03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_UP03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_UP03-28 08:05:15.044 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onClick\n\n\ndispatchTouchEvent 、 OnTouchEvent 这两个方法的返回值存在三种情况：\n\n直接返回true。\n直接返回false。\n返回父类同名方法，super.dispatchTouchEvent 或者 super.OnTouchEvent。\n\n由于拥有不同的返回值，所以事件传递流程也有不同，经过不断修改返回值测试，最终得到了点击事件的流程图，ACTION_DOWN 和 ACTION_UP 事件的传递流程是相同的。\n3.3 事件传递流程图从上面的流程图可以得出结论：\n\n触摸事件是从 dispatchTouchEvent  开始的，默认返回父类同名方法 super ，事件将会依照嵌套层次从外向内传递（ MainActivity 到 MyTextView ），到达最内层的 View 时，将由 View 的 OnTouchEvent  方法处理，该方法返回 true 时进行消费不再传递，返回 false 时再由内向外传递，由外层的 OnTouchEvent 处理。\n如果外层向内层传递过程中，人为干扰返回 true 消费，则不会继续继续像内部传递。\nView 的事件控制顺序先执行 onTouch 再执行 onClick ，如果 onTouch 返回 true 消费，则不会继续传递，也不会执行 onClick 方法。\n\n四、ViewGroup的事件传递机制4.1 domeViewGroup 是 View 的控件容器存在，拥有 dispatchTouchEvent 、 onInterceptTouchEvent 和 onTouchEvent 三个方法，比 View 多了一个 onInterceptTouchEvent 方法。为了更好的观察，我们需要自定义 MyRelativeLayout 继承 RelativeLayout 。\nMyRelativeLayout类\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class MyRelativeLayout extends RelativeLayout &#123;    private final static String tag = \"MyRelativeLayout\";    public MyRelativeLayout(Context context) &#123;        super(context);    &#125;    public MyRelativeLayout(Context context, AttributeSet attrs) &#123;        super(context, attrs);    &#125;    @Override    public boolean dispatchTouchEvent(MotionEvent ev) &#123;        switch (ev.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"dispatchTouchEvent ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"dispatchTouchEvent ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"dispatchTouchEvent ACTION_DOWN\");                break;        &#125;        return super.dispatchTouchEvent(ev);    &#125;    @Override    public boolean onInterceptTouchEvent(MotionEvent ev) &#123;        switch (ev.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"onInterceptTouchEvent ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"onInterceptTouchEvent ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"onInterceptTouchEvent ACTION_DOWN\");                break;        &#125;        return super.onInterceptTouchEvent(ev);    &#125;    @Override    public boolean onTouchEvent(MotionEvent event) &#123;        switch (event.getAction())&#123;            case MotionEvent.ACTION_UP:                Log.i(tag, \"onTouchEvent ACTION_UP\");                break;            case MotionEvent.ACTION_MOVE:                Log.i(tag, \"onTouchEvent ACTION_MOVE\");                break;            case MotionEvent.ACTION_DOWN:                Log.i(tag, \"onTouchEvent ACTION_DOWN\");                break;        &#125;        return super.onTouchEvent(event);    &#125;&#125;\n\nmain_activity.xml 文件\n12345678910111213141516&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;com.mvp.chenzhesheng.androidadvance.MyRelativeLayout    xmlns:android=\"http://schemas.android.com/apk/res/android\"    xmlns:tools=\"http://schemas.android.com/tools\"    android:layout_width=\"match_parent\"    android:layout_height=\"match_parent\"    &gt;    &lt;com.mvp.chenzhesheng.androidadvance.MyTextView        android:id=\"@+id/text_view\"        android:clickable=\"true\"        android:layout_width=\"wrap_content\"        android:layout_height=\"wrap_content\"        android:text=\"Hello World!\"&lt;/com.mvp.chenzhesheng.androidadvance.MyRelativeLayout&gt;\n\n4.2 打印日志1234567891011121304-02 08:47:57.980 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_DOWN04-02 08:47:58.000 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: dispatchTouchEvent ACTION_DOWN04-02 08:47:58.000 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: onInterceptTouchEvent ACTION_DOWN04-02 08:47:58.000 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_DOWN04-02 08:47:58.010 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_DOWN04-02 08:47:58.010 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_DOWN04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_UP04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: dispatchTouchEvent ACTION_UP04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: onInterceptTouchEvent ACTION_UP04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_UP04-02 08:47:58.210 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_UP04-02 08:47:58.210 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_UP04-02 08:47:58.260 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onClick\n\n\n可以看到 MainActivity 和 MyTextView 的事件传递处理中添加了一层 MyRelativeLayout 。通过不同返回值测试，得到一套流程图。\n4.3 流程图从上面的流程图可以得出结论：\n\n触摸事件传递是从 Activity 传递到 ViewGroup ,再传递到 View 。如果中间没有 ViewGroup 则直接从 Activity 传递到 View 。\nViewGroup 通过 onInterceptTouchEvent 方法对事件进行截拦，如果返回 false 或者 super.onInterceptTouchEvent ，则事件会继续传递给子 View 。\n子 View 中对事件进行消费后，ViewGroup 将不会接收到任何事件。\n\n五.总结\n事件分发是由外到内，从 Activity 到具体的子 View ；\n事件处理消费是由内到外，从子 View 到最外层 Activity ；\n事件拦截只存在于 ViewGroup 中；\n掌握事件传递机制可以更好的进行事件处理，无论是自定义 View 还是阅读 Framework 层源码都需要对事件传递进行学习，才能更精致的开发应用。\n\n\n","dateCreated":"2018-03-27T19:05:51+08:00","dateModified":"2019-04-20T17:19:32+08:00","datePublished":"2018-03-27T19:05:51+08:00","description":"** Android触摸事件传递机制：** &lt;Excerpt in index | 首页摘要&gt;本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。","headline":"Android触摸事件传递机制","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"/www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"},"publisher":{"@type":"Organization","name":"陈哲生","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"url":"/www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/","keywords":"Android"}</script>
    <meta name="description" content="** Android触摸事件传递机制：** &amp;lt;Excerpt in index | 首页摘要&amp;gt;本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。">
<meta name="keywords" content="Android">
<meta property="og:type" content="blog">
<meta property="og:title" content="Android触摸事件传递机制">
<meta property="og:url" content="www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/index.html">
<meta property="og:site_name" content="chenzhesheng的博客">
<meta property="og:description" content="** Android触摸事件传递机制：** &amp;lt;Excerpt in index | 首页摘要&amp;gt;本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog.zsonchen.cn/android%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6View%E7%9A%84%E4%BC%A0%E9%80%92.jpg?imageView2/0/q/100%7Cwatermark/2/text/5YWs5LyX5Y-377ya5oqA5pyv5bCP5L2c5Z2K/font/5a6L5L2T/fontsize/480/fill/I0JEQjdCNw==/dissolve/50/gravity/SouthEast/dx/30/dy/30">
<meta property="og:image" content="http://blog.zsonchen.cn/android%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6View%E3%80%81ViewGroup%E3%80%81Activity.jpg?imageView2/0/q/100%7Cwatermark/2/text/5YWs5LyX5Y-377ya5oqA5pyv5bCP5L2c5Z2K/font/5a6L5L2T/fontsize/480/fill/I0JEQjdCNw==/dissolve/50/gravity/SouthEast/dx/30/dy/30">
<meta property="og:image" content="http://blog.zsonchen.cn/wxchat_QR.jpg">
<meta property="og:updated_time" content="2019-04-20T09:19:32.342Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android触摸事件传递机制">
<meta name="twitter:description" content="** Android触摸事件传递机制：** &amp;lt;Excerpt in index | 首页摘要&amp;gt;本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。">
<meta name="twitter:image" content="http://blog.zsonchen.cn/android%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6View%E7%9A%84%E4%BC%A0%E9%80%92.jpg?imageView2/0/q/100%7Cwatermark/2/text/5YWs5LyX5Y-377ya5oqA5pyv5bCP5L2c5Z2K/font/5a6L5L2T/fontsize/480/fill/I0JEQjdCNw==/dissolve/50/gravity/SouthEast/dx/30/dy/30">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/ "
            aria-label=""
        >
            chenzhesheng的博客
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Öffne den Link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Kategorien"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Kategorien</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archiv"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archiv</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                            title="Suche"
                        >
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Suche</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="Über"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Über</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://stackoverflow.com/users" target="_blank" rel="noopener" title="Stack Overflow">
                    
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://plus.google.com/" target="_blank" rel="noopener" title="Google Plus">
                    
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google Plus</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/profile/" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/mailto"
                            title="E-Mail"
                        >
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">E-Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Android触摸事件传递机制
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2018-03-27T19:05:51+08:00">
	
		    27 Mar 2018
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>** Android触摸事件传递机制：** &lt;Excerpt in index | 首页摘要&gt;<br>本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。</p>
<a id="more"></a>
<p>&lt;The rest of contents | 余下全文&gt;<br>    前言：在Android开发中，经常会遇到触摸事件冲突，比如ViewPager的轮播图跟Fragment的划动事件冲突，或者轮播图跟下拉事件冲突，自定义view的事件处理等，本文章将会详细介绍Activity、View、ViewGroup三者的触摸事件传递机制，传递包括三个阶段：分发、拦截、消费。</p>
<h2 id="一-触摸事件的类型"><a href="#一-触摸事件的类型" class="headerlink" title="一.触摸事件的类型"></a>一.触摸事件的类型</h2><p>触摸事件对应的是 <strong>MotionEvent</strong> 类，事件类型主要有三种：</p>
<ol>
<li>ACTION_DOWN：用户按下操作，表示一次触摸事件的开始。 </li>
<li>ACTION_MOVE：在按下的情况下，进行移动。轻微的移动都会传递到该事件。</li>
<li>ACTION_UP：用户手指离开屏幕，表示一次触摸事件的</li>
</ol>
<p>注 ：如果用户仅仅的是点击而已，则只会执行到 ACTION_DOWN 和 ACTION_UP 两个事件，不会执行到 ACTION_MOVE 事件。所以 ACTION_DOWN 和 ACTION_UP 是事件是必须的。</p>
<h2 id="二-触摸事件的传递阶段"><a href="#二-触摸事件的传递阶段" class="headerlink" title="二.触摸事件的传递阶段"></a>二.触摸事件的传递阶段</h2><h3 id="1-分发（Dispatch）"><a href="#1-分发（Dispatch）" class="headerlink" title="1.分发（Dispatch）"></a>1.分发（Dispatch）</h3><p>在Android系统中所有的触摸事件都是由 <strong>dispatchTouchEvent</strong>  方法进行分发的。该方法中判断事件是被消费（<strong>return true</strong>），还是继续分发给子视图处理（<strong>return super.dispatchTouchEvent</strong>），如果当前视图是ViewGroup或者其子类，则会调用<strong>onInterceptTouchEvent</strong> 判断是否截拦。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean dispatchTouchEvent(MotionEvent event) &#123;</span><br><span class="line">    <span class="built_in">return</span> super.dispatchTouchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-截拦（Intercept）"><a href="#2-截拦（Intercept）" class="headerlink" title="2.截拦（Intercept）"></a>2.截拦（Intercept）</h3><p>事件的截拦 <strong>InterceptTouchEvent</strong>  只存在于ViewGroup及其子类，activity和View是不存在该方法。该方法判断事件是被截拦 （<strong>return true</strong>）并交给自身的 <strong>OnToucEvent</strong> 方法进行消费，还是继续传递给子视图（<strong>return super.InterceptTouchEvent</strong> 或者 <strong>return false</strong>）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onInterceptTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">    <span class="built_in">return</span> super.onInterceptTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-消费（Consume）"><a href="#3-消费（Consume）" class="headerlink" title="3.消费（Consume）"></a>3.消费（Consume）</h3><p>事件的消费通过 <strong>OnTouchEvent</strong> 方法判断，是被消费（<strong>return true</strong>）,还是不处理（<strong>return false</strong>）并将事件传递给父视图的 <strong>OnTouchEvent</strong> 方法进行处理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">    <span class="built_in">return</span> super.onTouchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有拥有事件传递能力的类：<br>Activity： 拥有dispatchTouchEvent 、OnTouchEvent<br>ViewGroup： 拥有dispatchTouchEvent 、OnInterceptTouchEvent 、OnTouchEvent<br>View：拥有dispatchTouchEvent 、OnTouchEvent</p>
<h2 id="三、View的事件传递机制"><a href="#三、View的事件传递机制" class="headerlink" title="三、View的事件传递机制"></a>三、View的事件传递机制</h2><h3 id="3-1-dome"><a href="#3-1-dome" class="headerlink" title="3.1 dome"></a>3.1 dome</h3><p>虽然说ViewGroup是View的子类，但是这是说的View指的是除ViewGroup之外的View控件子类，首先定义一个MyTextView继承TextView，打印每次事件的触发以变了解事件传递的流程。</p>
<p>MyTextView 类</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">public class MyTextView extends TextView &#123;</span><br><span class="line"></span><br><span class="line">    private String tag = <span class="string">"MyTextView"</span>;</span><br><span class="line"></span><br><span class="line">    public MyTextView(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MyTextView(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean dispatchTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        switch (event.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> super.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        switch (event.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> super.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>定义一个MainActivity来展现这个MyTextView，同时设置点击（onClick）和触摸（onTouch）监听。<br>MainActivity 类</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener,View.OnTouchListener&#123;</span><br><span class="line">    private MyTextView mMyTextView;</span><br><span class="line">    private String tag = <span class="string">"MainActiviy"</span>;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        mMyTextView = findViewById(R.id.text_view);</span><br><span class="line">        //  点击监听</span><br><span class="line">        mMyTextView.setOnClickListener(this);</span><br><span class="line">        //  触碰监听</span><br><span class="line">        mMyTextView.setOnTouchListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // MyTextView 点击事件</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View view) &#123;</span><br><span class="line">        switch (view.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.text_view:</span><br><span class="line">                Log.i(tag, <span class="string">"MyTextView onClick"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // MyTextView 触碰事件</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouch(View view, MotionEvent motionEvent) &#123;</span><br><span class="line">        switch (motionEvent.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"MyTextView onTouch ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"MyTextView onTouch ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"MyTextView onTouch ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Activity　的事件分发</span><br><span class="line">    @Override</span><br><span class="line">    public boolean dispatchTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">        switch (ev.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> super.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Activity 的事件消费</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        switch (event.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> super.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-打印日志"><a href="#3-2-打印日志" class="headerlink" title="3.2 打印日志"></a>3.2 打印日志</h3><p>运行后，点击Text View反馈的打印日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">03-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_DOWN</span><br><span class="line">03-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_DOWN</span><br><span class="line">03-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_DOWN</span><br><span class="line">03-28 08:05:14.824 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_DOWN</span><br><span class="line">03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_UP</span><br><span class="line">03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_UP</span><br><span class="line">03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_UP</span><br><span class="line">03-28 08:05:15.034 1219-1219/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_UP</span><br><span class="line">03-28 08:05:15.044 1219-1219/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onClick</span><br></pre></td></tr></table></figure>

<hr>
<p>dispatchTouchEvent 、 OnTouchEvent 这两个方法的返回值存在三种情况：</p>
<ol>
<li>直接返回true。</li>
<li>直接返回false。</li>
<li>返回父类同名方法，super.dispatchTouchEvent 或者 super.OnTouchEvent。</li>
</ol>
<p>由于拥有不同的返回值，所以事件传递流程也有不同，经过不断修改返回值测试，最终得到了点击事件的流程图，ACTION_DOWN 和 ACTION_UP 事件的传递流程是相同的。</p>
<h3 id="3-3-事件传递流程图"><a href="#3-3-事件传递流程图" class="headerlink" title="3.3 事件传递流程图"></a>3.3 事件传递流程图</h3><p><img src="http://blog.zsonchen.cn/android%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6View%E7%9A%84%E4%BC%A0%E9%80%92.jpg?imageView2/0/q/100%7Cwatermark/2/text/5YWs5LyX5Y-377ya5oqA5pyv5bCP5L2c5Z2K/font/5a6L5L2T/fontsize/480/fill/I0JEQjdCNw==/dissolve/50/gravity/SouthEast/dx/30/dy/30" alt><br>从上面的流程图可以得出结论：</p>
<ol>
<li>触摸事件是从 <strong>dispatchTouchEvent</strong>  开始的，默认返回父类同名方法 <strong>super</strong> ，事件将会依照嵌套层次从外向内传递（ <strong>MainActivity</strong> 到 <strong>MyTextView</strong> ），到达最内层的 <strong>View</strong> 时，将由 <strong>View</strong> 的 <strong>OnTouchEvent</strong>  方法处理，该方法返回 <strong>true</strong> 时进行消费不再传递，返回 <strong>false</strong> 时再由内向外传递，由外层的 <strong>OnTouchEvent</strong> 处理。</li>
<li>如果外层向内层传递过程中，人为干扰返回 <strong>true</strong> 消费，则不会继续继续像内部传递。</li>
<li><strong>View</strong> 的事件控制顺序先执行 <strong>onTouch</strong> 再执行 <strong>onClick</strong> ，如果 <strong>onTouch</strong> 返回 <strong>true</strong> 消费，则不会继续传递，也不会执行 <strong>onClick</strong> 方法。</li>
</ol>
<h2 id="四、ViewGroup的事件传递机制"><a href="#四、ViewGroup的事件传递机制" class="headerlink" title="四、ViewGroup的事件传递机制"></a>四、ViewGroup的事件传递机制</h2><h3 id="4-1-dome"><a href="#4-1-dome" class="headerlink" title="4.1 dome"></a>4.1 dome</h3><p><strong>ViewGroup</strong> 是 <strong>View</strong> 的控件容器存在，拥有 <strong>dispatchTouchEvent</strong> 、 <strong>onInterceptTouchEvent</strong> 和 <strong>onTouchEvent</strong> 三个方法，比 <strong>View</strong> 多了一个 <strong>onInterceptTouchEvent</strong> 方法。为了更好的观察，我们需要自定义 <strong>MyRelativeLayout</strong> 继承 <strong>RelativeLayout</strong> 。</p>
<p>MyRelativeLayout类</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">public class MyRelativeLayout extends RelativeLayout &#123;</span><br><span class="line"></span><br><span class="line">    private final static String tag = <span class="string">"MyRelativeLayout"</span>;</span><br><span class="line"></span><br><span class="line">    public MyRelativeLayout(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MyRelativeLayout(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean dispatchTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">        switch (ev.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"dispatchTouchEvent ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> super.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onInterceptTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">        switch (ev.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"onInterceptTouchEvent ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"onInterceptTouchEvent ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"onInterceptTouchEvent ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> super.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        switch (event.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_UP"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_MOVE"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(tag, <span class="string">"onTouchEvent ACTION_DOWN"</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> super.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main_activity.xml 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;com.mvp.chenzhesheng.androidadvance.MyRelativeLayout</span><br><span class="line">    xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.mvp.chenzhesheng.androidadvance.MyTextView</span><br><span class="line">        android:id=<span class="string">"@+id/text_view"</span></span><br><span class="line">        android:clickable=<span class="string">"true"</span></span><br><span class="line">        android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:text=<span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line">&lt;/com.mvp.chenzhesheng.androidadvance.MyRelativeLayout&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-打印日志"><a href="#4-2-打印日志" class="headerlink" title="4.2 打印日志"></a>4.2 打印日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">04-02 08:47:57.980 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_DOWN</span><br><span class="line">04-02 08:47:58.000 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: dispatchTouchEvent ACTION_DOWN</span><br><span class="line">04-02 08:47:58.000 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: onInterceptTouchEvent ACTION_DOWN</span><br><span class="line">04-02 08:47:58.000 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_DOWN</span><br><span class="line">04-02 08:47:58.010 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_DOWN</span><br><span class="line">04-02 08:47:58.010 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_DOWN</span><br><span class="line">04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: dispatchTouchEvent ACTION_UP</span><br><span class="line">04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: dispatchTouchEvent ACTION_UP</span><br><span class="line">04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyRelativeLayout: onInterceptTouchEvent ACTION_UP</span><br><span class="line">04-02 08:47:58.200 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: dispatchTouchEvent ACTION_UP</span><br><span class="line">04-02 08:47:58.210 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onTouch ACTION_UP</span><br><span class="line">04-02 08:47:58.210 1030-1030/com.mvp.chenzhesheng.androidadvance I/MyTextView: onTouchEvent ACTION_UP</span><br><span class="line">04-02 08:47:58.260 1030-1030/com.mvp.chenzhesheng.androidadvance I/MainActiviy: MyTextView onClick</span><br></pre></td></tr></table></figure>

<hr>
<p>可以看到 <strong>MainActivity</strong> 和 <strong>MyTextView</strong> 的事件传递处理中添加了一层 <strong>MyRelativeLayout</strong> 。通过不同返回值测试，得到一套流程图。</p>
<h3 id="4-3-流程图"><a href="#4-3-流程图" class="headerlink" title="4.3 流程图"></a>4.3 流程图</h3><p><img src="http://blog.zsonchen.cn/android%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6View%E3%80%81ViewGroup%E3%80%81Activity.jpg?imageView2/0/q/100%7Cwatermark/2/text/5YWs5LyX5Y-377ya5oqA5pyv5bCP5L2c5Z2K/font/5a6L5L2T/fontsize/480/fill/I0JEQjdCNw==/dissolve/50/gravity/SouthEast/dx/30/dy/30" alt><br>从上面的流程图可以得出结论：</p>
<ol>
<li>触摸事件传递是从 <strong>Activity</strong> 传递到 <strong>ViewGroup</strong> ,再传递到 <strong>View</strong> 。如果中间没有 <strong>ViewGroup</strong> 则直接从 <strong>Activity</strong> 传递到 <strong>View</strong> 。</li>
<li><strong>ViewGroup</strong> 通过 <strong>onInterceptTouchEvent</strong> 方法对事件进行截拦，如果返回 <strong>false</strong> 或者 <strong>super.onInterceptTouchEvent</strong> ，则事件会继续传递给子 <strong>View</strong> 。</li>
<li>子 <strong>View</strong> 中对事件进行消费后，<strong>ViewGroup</strong> 将不会接收到任何事件。</li>
</ol>
<h2 id="五-总结"><a href="#五-总结" class="headerlink" title="五.总结"></a>五.总结</h2><ol>
<li>事件分发是由外到内，从 <strong>Activity</strong> 到具体的子 <strong>View</strong> ；</li>
<li>事件处理消费是由内到外，从子 <strong>View</strong> 到最外层 <strong>Activity</strong> ；</li>
<li>事件拦截只存在于 <strong>ViewGroup</strong> 中；</li>
<li>掌握事件传递机制可以更好的进行事件处理，无论是自定义 <strong>View</strong> 还是阅读 <strong>Framework</strong> 层源码都需要对事件传递进行学习，才能更精致的开发应用。</li>
</ol>
<p><img src="http://blog.zsonchen.cn/wxchat_QR.jpg" alt></p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">GETAGGT IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Android/">Android</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/04/19/Dagger2注解框架在kotlin中的使用/"
                    data-tooltip="Dagger2注解框架在kotlin中的使用"
                    aria-label="FRÜHER: Dagger2注解框架在kotlin中的使用"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">FRÜHER</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/03/17/基于Ubuntu16-0-4版本linux系统下的腾讯云java后台服务器学习指南/"
                    data-tooltip="基于Ubuntu16.0.4版本linux系统下的腾讯云java后台服务器学习指南"
                    aria-label="NÄCHSTER: 基于Ubuntu16.0.4版本linux系统下的腾讯云java后台服务器学习指南"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NÄCHSTER</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                    title="Teilen auf Facebook"
                    aria-label="Teilen auf Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                    title="Teilen auf Twitter"
                    aria-label="Teilen auf Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                    title="Teilen auf Google Plus"
                    aria-label="Teilen auf Google Plus"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2019 陈哲生. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/04/19/Dagger2注解框架在kotlin中的使用/"
                    data-tooltip="Dagger2注解框架在kotlin中的使用"
                    aria-label="FRÜHER: Dagger2注解框架在kotlin中的使用"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">FRÜHER</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/03/17/基于Ubuntu16-0-4版本linux系统下的腾讯云java后台服务器学习指南/"
                    data-tooltip="基于Ubuntu16.0.4版本linux系统下的腾讯云java后台服务器学习指南"
                    aria-label="NÄCHSTER: 基于Ubuntu16.0.4版本linux系统下的腾讯云java后台服务器学习指南"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NÄCHSTER</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                    title="Teilen auf Facebook"
                    aria-label="Teilen auf Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                    title="Teilen auf Twitter"
                    aria-label="Teilen auf Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                    title="Teilen auf Google Plus"
                    aria-label="Teilen auf Google Plus"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                        aria-label="Teilen auf Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Teilen auf Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                        aria-label="Teilen auf Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Teilen auf Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=www.chenzhesheng.cc/2018/03/27/Android触摸事件传递机制/"
                        aria-label="Teilen auf Google Plus"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Teilen auf Google Plus</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">陈哲生</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->


    




    </body>
</html>
